{% extends "base.html" %}

{% block head %}
  <title>{{ product.meta_title|default:product.product_name }}</title>
  <meta name="description" content="{{ product.meta_description|default_if_none:'' }}">
{% endblock head %}

{% block content %}

<style>
    .carousel-control-prev-icon,
    .carousel-control-next-icon {
        background-color: rgba(0, 0, 0, 0.5); /* Dark semi-transparent */
        border-radius: 50%;
        padding: 10px;
    }
</style>

<div class="container mt-4">
  <!-- Product Detail Card -->
  <div class="row">
    <!-- Left: Carousel and Images -->
    <div class="col-lg-6 mb-4">
      <div id="productCarousel" class="carousel slide card shadow-sm h-100 overflow-hidden" data-bs-ride="carousel">
        <div class="carousel-inner">
          {% for image in product.images.all %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <img src="{% if image.image %}{{ image.image.url }}{% else %}{{ image.image_url }}{% endif %}"
                   class="d-block w-100 rounded shadow img-fluid h-100"
                   style="height: 350px; object-fit: cover; border-radius: 0.5rem;"
                   alt="Image {{ forloop.counter }}" loading="lazy">
            </div>
          {% endfor %}
        </div>

        {% if product.images.count > 1 %}
        <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
        {% endif %}
      </div>
    </div>

    <!-- Right: Product Info -->
    <div class="col-lg-6">
      <div class="bg-light p-4 rounded shadow h-100 d-flex flex-column justify-content-between" style="border: 1px solid #dee2e6;">
        <div>
          <h2 class="text-dark fw-semibold mb-3" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
            {{ product.product_name }}
          </h2>

          <p class="h4 text-success fw-bold mb-2">Rs. {{ product.product_price }}</p>

          <p class="text-secondary mb-2">
            <span class="fw-semibold">Category:</span> {{ product.category.name }}
          </p>

          <p class="fw-bold {% if product.stock > 0 %}text-success{% else %}text-danger{% endif %} mb-3">
            {% if product.stock > 0 %}In Stock ({{ product.stock }}){% else %}Out of Stock{% endif %}
          </p>

          <hr class="my-3">

          <h5 class="mt-3 mb-2 text-dark" style="font-weight: 600;">Description</h5>
          <p class="text-muted" style="font-size: 1.05rem; line-height: 1.6; font-family: 'Roboto', sans-serif;">
            {{ product.product_description|safe }}
          </p>
        </div>

        {% if product.stock > 0 %}
        <div class="d-flex flex-column flex-md-row gap-3 mt-4">
          <button onclick="addToCart(event, '{{ product.product_slug }}')" class="btn btn-outline-primary btn-lg w-100">
             Add to Cart
          </button>
          <a href="/order/{{ product.product_slug }}" class="btn btn-success btn-lg w-100">
             Order Now
          </a>
        </div>
     
      </div>
    </div>
  </div>
</div>

<!-- SweetAlert2 Popup Library -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Add to Cart Script -->

{% else %}
<div class="text-center mt-5">
  <h4 class="text-danger">You must be logged in to view product details.</h4>
  <a href="{% url 'login' %}" class="btn btn-primary mt-3">Login</a>
</div>
{% endif %}
{% endblock content %}
